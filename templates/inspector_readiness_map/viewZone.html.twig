{% extends 'default/base.html.twig' %}
{% block styles %}
    <link href="{{ asset('css/plugins/blueimp/css/blueimp-gallery.min.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

    {% set name = zone.getName() %}
    {% set zoneType = zone.getType().getName() == 'Зона по видам работ' %}
    <div class="row mt-3">
        <div class="col-lg-10 offset-lg-1 col-md-10 offset-md-1 mb-2">
            <div class="ibox collapsed border-bottom">

                <div class="ibox-title">
                    <h5>
                        {{ name }}
                    </h5>
                </div>


                <div class="ibox-content" style="display: block;">
                    <a href="{{ path('app_inspector_readiness_map', {'id': zone.getAddres().getUser().getId()}) }}">
                        <button class="btn mb-3">
                            <i class="fa fa-arrow-left">
                                Назад
                            </i>
                        </button>
                    </a>
                    <div class="tabs-container">
                        <ul class="nav nav-tabs" role="tablist">
                            <li><a class="nav-link active show" data-toggle="tab" href="#tab-1"> Ремонт</a></li>
                            {% if zoneType %}
                                <li><a class="nav-link" data-toggle="tab" href="#tab-2"> Инфраструктурный лист</a></li>
                            {% endif %}
                        </ul>
                        <div class="tab-content">
                            <div role="tabpanel" id="tab-1" class="tab-pane active show">
                                <div class="panel-body">
                                    <table class="table table-bordered">
                                        {% set repair = zone.getZoneRepair() %}

                                        <thead>
                                            <tr>
                                                <td class="col-md-1">
                                                    Процент готовности
                                                </td>
                                                <td class="col-md-3">
                                                    Дата окончания
                                                </td>
                                                <td>
                                                    Комментарий
                                                </td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>
                                                0 %
                                            </td>
                                            <td>
                                                {% if repair.getEndDate() %}
                                                    {{ repair.getEndDate().format('d.m.Y') }}
                                                {% else %}
                                                    <span class="badge badge-warning">
                                                        Дата не указана
                                                    </span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ repair.getComment() }}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <h4>Процесс ремонта</h4>
                                    <hr>
                                    <h5>Общий процент <b>{{ repair.getTotalPercentage() }} %</b></h5>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-primary" role="progressbar" style="width: {{ repair.getDismaltingPercentage() }}%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-success" role="progressbar" style="width: {{ repair.getPlasteringAndCommunicationPercentage()  }}%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width: {{ repair.getFinishingPercentage() }}%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-danger" role="progressbar" style="width: {{ repair.getBrandingPercentage() }}%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            {% if not repair.isNotPlanned() %}
                                            <h5>Демонтажные работы <b>{{ repair.getDismantling() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-primary" style="width: {{ repair.getDismantling() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <h5>Штукатурные и коммуникационные работы <b>{{ repair.getPlasteringAndCommunication() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar  progress-bar-success" style="width: {{ repair.getPlasteringAndCommunication() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <h5>Отделочные работы <b>{{ repair.getFinishing() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning" style="width: {{ repair.getFinishing() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            {% endif %}
                                            <h5>Брендирование <b>{{ repair.getBranding() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar  progress-bar-danger" style="width: {{ repair.getBranding() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr>
                                    <h5>Фотографии</h5>
                                    <hr>
                                    <div class="row ml-1">
                                        <div class="lightBoxGallery">
                                            {% for i in pagination %}
                                                <div class="text-left">
                                                    <h5>
                                                        {{ i.getCreatedAt().format('m.d.Y') }}
                                                    </h5>
                                                </div>
                                                {% for j in i.getRepairPhotos() %}
                                                    <a href="{{ asset('/uploads/repairPhotos/'~j.getPhoto()) }}" title="{{ name }}" data-gallery="">
                                                        <img src="{{ asset('/uploads/repairPhotos/'~j.getPhoto()) }}" style="width: 100px">
                                                    </a>
                                                {% endfor %}
                                            {% endfor %}
                                            <!-- The Gallery as lightbox dialog, should be a child element of the document body -->
                                            <div id="blueimp-gallery" class="blueimp-gallery">
                                                <div class="slides"></div>
                                                <h3 class="title"></h3>
                                                <a class="prev">‹</a>
                                                <a class="next">›</a>
                                                <a class="close">×</a>
                                                <a class="play-pause"></a>
                                                <ol class="indicator"></ol>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="navigation">
                                            {{ knp_pagination_render(pagination, 'default/twitter_bootstrap_v3_pagination.html.twig') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div role="tabpanel" id="tab-2" class="tab-pane">
                                <div class="panel-body">
                                    {% if infrastructure|length > 0 %}
                                        <div class="row mb-3 ml-1">
                                            <a href="{{ path('app_inspector_rm_infrastructure_sheet', {'id' : zone.getId()}) }}">
                                                <button class="btn btn-primary ">
                                                    <i class="fa fa-edit">
                                                        Изменить ИЛ
                                                    </i>
                                                </button>
                                            </a>

                                        </div>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="9">
                                                        <h3>
                                                            Общая зона
                                                        </h3>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="col-sm-1">
                                                        № п/п
                                                    </td>
                                                    <td class="col-md-3">
                                                        Наименование
                                                    </td>
                                                    <td class="col-md-1">
                                                        Вид
                                                    </td>
                                                    <td class="col-md-1">
                                                        Общее кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Ед. измерения
                                                    </td>
                                                    <td class="col-md-1">
                                                        Фактическое <br> кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Введено в эксплуатацию
                                                    </td>
                                                    <td class="col-md-1">
                                                        Дата поставки
                                                    </td>
                                                    <td class="col-md-3">
                                                        Комментарий
                                                    </td>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                {#{% for item in form.tags %}#}
                                                    {#<li>{{ form_row(tag.name) }}</li>#}
                                                {#{% endfor %}#}
                                                {% set count = 1 %}
                                                {% for i in infrastructure|reverse %}
                                                    {% if i.getZoneType() == 'Общая зона' %}
                                                    <tr>
                                                        <td>{{ count }}</td>
                                                        <td>{{ i.getName() }}</td>
                                                        <td>{{ i.getType() }}</td>
                                                        <td>{{ i.getTotalNumber() }}</td>
                                                        <td>{{ i.getUnits() }}</td>
                                                        <td>{{ i.getFactNumber() }}</td>
                                                        <td>{{ i.getPutIntoOperation() }}</td>
                                                        {% if i.getDeliveryDate() %}
                                                            <td>{{ i.getDeliveryDate().format('d.m.Y') }}</td>
                                                        {% else %}
                                                            <td>Дата не указана</td>
                                                        {% endif %}
                                                        <td>{{ i.getComment() }}</td>
                                                    </tr>
                                                        {% set count = count + 1 %}
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="9">
                                                        <h3>
                                                            Рабочее место учащегося
                                                        </h3>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="col-sm-1">
                                                        № п/п
                                                    </td>
                                                    <td class="col-md-3">
                                                        Наименование
                                                    </td>
                                                    <td class="col-md-1">
                                                        Вид
                                                    </td>
                                                    <td class="col-md-1">
                                                        Общее кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Ед. измерения
                                                    </td>
                                                    <td class="col-md-1">
                                                        Фактическое <br> кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Введено в эксплуатацию
                                                    </td>
                                                    <td class="col-md-1">
                                                        Дата поставки
                                                    </td>
                                                    <td class="col-md-3">
                                                        Комментарий
                                                    </td>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                {#{% for item in form.tags %}#}
                                                    {#<li>{{ form_row(tag.name) }}</li>#}
                                                {#{% endfor %}#}
                                                {% set count = 1 %}
                                                {% for i in infrastructure|reverse %}
                                                    {% if i.getZoneType() == 'Рабочее место учащегося' %}
                                                    <tr>
                                                        <td>{{ count }}</td>
                                                        <td>{{ i.getName() }}</td>
                                                        <td>{{ i.getType() }}</td>
                                                        <td>{{ i.getTotalNumber() }}</td>
                                                        <td>{{ i.getUnits() }}</td>
                                                        <td>{{ i.getFactNumber() }}</td>
                                                        <td>{{ i.getPutIntoOperation() }}</td>
                                                        {% if i.getDeliveryDate() %}
                                                            <td>{{ i.getDeliveryDate().format('d.m.Y') }}</td>
                                                        {% else %}
                                                            <td>Дата не указана</td>
                                                        {% endif %}
                                                        <td>{{ i.getComment() }}</td>
                                                    </tr>
                                                        {% set count = count + 1 %}
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="9">
                                                        <h3>
                                                            Рабочее место преподавателя
                                                        </h3>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="col-sm-1">
                                                        № п/п
                                                    </td>
                                                    <td class="col-md-3">
                                                        Наименование
                                                    </td>
                                                    <td class="col-md-1">
                                                        Вид
                                                    </td>
                                                    <td class="col-md-1">
                                                        Общее кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Ед. измерения
                                                    </td>
                                                    <td class="col-md-1">
                                                        Фактическое <br> кол-во
                                                    </td>
                                                    <td class="col-md-1">
                                                        Введено в эксплуатацию
                                                    </td>
                                                    <td class="col-md-1">
                                                        Дата поставки
                                                    </td>
                                                    <td class="col-md-3">
                                                        Комментарий
                                                    </td>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                {#{% for item in form.tags %}#}
                                                    {#<li>{{ form_row(tag.name) }}</li>#}
                                                {#{% endfor %}#}
                                                {% set count = 1 %}
                                                {% for i in infrastructure|reverse %}
                                                    {% if i.getZoneType() == 'Рабочее место преподавателя' %}
                                                    <tr>
                                                        <td>{{ count }}</td>
                                                        <td>{{ i.getName() }}</td>
                                                        <td>{{ i.getType() }}</td>
                                                        <td>{{ i.getTotalNumber() }}</td>
                                                        <td>{{ i.getUnits() }}</td>
                                                        <td>{{ i.getFactNumber() }}</td>
                                                        <td>{{ i.getPutIntoOperation() }}</td>
                                                        {% if i.getDeliveryDate() %}
                                                            <td>{{ i.getDeliveryDate().format('d.m.Y') }}</td>
                                                        {% else %}
                                                            <td>Дата не указана</td>
                                                        {% endif %}
                                                        <td>{{ i.getComment() }}</td>
                                                    </tr>
                                                        {% set count = count + 1 %}
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <div class="col-lg-6 offset-lg-3">
                                            <div class="panel panel-warning">
                                                <div class="panel-heading">
                                                    <i class="fa fa-warning"></i> Нет инфраструктурного листа
                                                </div>
                                                <div class="panel-body">
                                                    <a href="{{ path('app_inspector_rm_infrastructure_sheet', {'id' : zone.getId()}) }}">
                                                        <button class="btn col-lg-12">
                                                            <i class="fa fa-table">
                                                                Добавить ИЛ
                                                            </i>
                                                        </button>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}


                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="ibox-footer">

                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ asset('js/popper.min.js') }}"></script>
    <script src="{{ asset('js/inspinia.js') }}"></script>
    <script src="{{ asset('js/plugins/pace/pace.min.js') }}"></script>
    <script src="{{ asset('js/plugins/blueimp/jquery.blueimp-gallery.min.js') }}"></script>
{% endblock %}