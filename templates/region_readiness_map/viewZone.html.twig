{% extends 'default/base.html.twig' %}
{% block styles %}
    <link href="{{ asset('css/plugins/blueimp/css/blueimp-gallery.min.css') }}" rel="stylesheet">
{% endblock %}
{% block content %}

    {% set zoneType = zone.getType().getName() == 'Зона по видам работ' %}
    {% set name = zone.getName() %}
    <div class="row mt-3">
        <div class="col-lg-12 col-md-12 col-sm-12 mb-2">
            <div class="ibox collapsed border-bottom">
                <a class="collapse-link">
                    <div class="ibox-title">
                        <h5>
                            {{ name }}
                        </h5>
                        <div class="ibox-tools">
                            <i class="fa fa-chevron-down"></i>
                        </div>
                    </div>
                </a>

                <div class="ibox-content" style="display: block;">
                    <a href="{{ path('app_region_readiness_map') }}">
                        <button class="btn mb-3">
                            <i class="fa fa-arrow-left">
                                Назад
                            </i>
                        </button>
                    </a>
                    <div class="tabs-container">
                        <ul class="nav nav-tabs" role="tablist">
                            <li><a class="nav-link active show" data-toggle="tab" href="#tab-1"> Ремонт</a></li>
                            {% if zoneType %}
                                <li><a class="nav-link" data-toggle="tab" href="#tab-2"> Инфраструктурный лист</a></li>
                            {% endif %}
                        </ul>
                        <div class="tab-content">
                            <div role="tabpanel" id="tab-1" class="tab-pane active show">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 col-sm-12 mb-3">
                                            <a href="{{ path('app_region_edit_repair_zone', {'id': zone.getId()}) }}">
                                                <button class="btn btn-outline-success col-lg-12">
                                                    <i class="fa fa-edit">
                                                        Внести изминения (Ремонт)
                                                    </i>
                                                </button>
                                            </a>
                                        </div>
                                    </div>
                                    <table class="table table-bordered">
                                        {% set repair = zone.getZoneRepair() %}


                                        <thead>
                                        <tr>
                                            <td class="col-md-1">
                                                Процент готовности
                                            </td>
                                            <td class="col-md-3">
                                                Дата окончания
                                            </td>
                                            <td>
                                                Комментарий
                                            </td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>
                                                {{ repair.getTotalPercentage() }} %
                                            </td>
                                            <td>
                                                {% if repair.getEndDate() %}
                                                    {{ repair.getEndDate().format('d.m.Y') }}
                                                {% else %}
                                                    <span class="badge badge-warning">
                                                        Дата не указана
                                                    </span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ repair.getComment()|raw }}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <h4>Процесс ремонта</h4>
                                    <hr>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <h5>Общий процент <b>{{ repair.getTotalPercentage() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-primary" role="progressbar" style="width: {{ repair.getDismaltingPercentage() }}%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-success" role="progressbar" style="width: {{ repair.getPlasteringAndCommunicationPercentage()  }}%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width: {{ repair.getFinishingPercentage() }}%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar progress-bar-danger" role="progressbar" style="width: {{ repair.getBrandingPercentage() }}%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            {% if not repair.isNotPlanned() %}
                                            <h5>Демонтажные работы <b>{{ repair.getDismantling() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-primary" style="width: {{ repair.getDismantling() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <h5>Штукатурные и коммуникационные работы <b>{{ repair.getPlasteringAndCommunication() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar  progress-bar-success" style="width: {{ repair.getPlasteringAndCommunication() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <h5>Отделочные работы <b>{{ repair.getFinishing() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning" style="width: {{ repair.getFinishing() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            {% endif %}
                                            {% if zone.getType().getName() != "Иное" %}
                                            <h5>Брендирование <b>{{ repair.getBranding() }} %</b></h5>
                                            <div class="progress">
                                                <div class="progress-bar  progress-bar-danger" style="width: {{ repair.getBranding() }}%" role="progressbar" aria-valuenow="{{ repair.getTotalPercentage() }}" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <hr>
                                    <h4>Фотографии</h4>
                                    <hr>
                                    <div class="row ">
                                        <div class="col-lg-10">
                                            <div class="lightBoxGallery">


                                                <div class="row">
                                                    {% for i in pagination %}
                                                        {#{% for j in i.getRepairPhotos() %}#}
                                                            <div class="col-lg-2 form-control m-1">
                                                                {% if i.allowToDelete(today) %}
                                                                    <a href="{{ path('app_region_rm_delete_photo_region', {'zone_id': zone.getId(), 'photo_id': i.getId()}) }}" class="pull-right btn btn-danger delete-alert">
                                                                        <span class="fa fa-trash "></span>
                                                                    </a>
                                                                {% endif %}
                                                                {#{{ i.getVersion().getCreatedAt().format('d.m.Y') }}#}
                                                                {#{{ i.allowToDelete(today) }}#}
                                                                <a href="{{ asset('/uploads/repairPhotos/'~i.getPhoto()) }}" title="{{ name }}" data-gallery="">
                                                                    <img src="{{ asset('/uploads/repairPhotos/'~i.getPhoto()) }}" class="col-lg-12">
                                                                </a>
                                                            </div>
                                                        {#{% endfor %}#}
                                                    {% endfor %}

                                                </div>


                                                <!-- The Gallery as lightbox dialog, should be a child element of the document body -->
                                                <div id="blueimp-gallery" class="blueimp-gallery">
                                                    <div class="slides"></div>
                                                    <h3 class="title"></h3>
                                                    <a class="prev">‹</a>
                                                    <a class="next">›</a>
                                                    <a class="close">×</a>
                                                    <a class="play-pause"></a>
                                                    <ol class="indicator"></ol>
                                                </div>

                                            </div>
                                        </div>


                                    </div>
                                    <div class="row">
                                        <div class="navigation">
                                            {{ knp_pagination_render(pagination, 'default/twitter_bootstrap_v3_pagination.html.twig') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% set thead %}
                                <tr>
                                    <td class="col-sm-1" style="vertical-align: inherit; text-align: center">
                                        <strong>№ п/п</strong>
                                    </td>
                                    <td class="col-md-3" style="vertical-align: inherit; text-align: center">
                                        <strong>Наименование</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Вид</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Общее кол-во</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Ед. измерения</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Фактическое <br> кол-во</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Введено в эксплуатацию</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Дата поставки</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>ОКПД2</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>КТРУ</strong>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: inherit; text-align: center">
                                        <strong>Страна-производитель</strong>
                                    </td>
                                    <td class="col-md-3" style="vertical-align: inherit; text-align: center">
                                        <strong>Комментарий</strong>
                                    </td>

                                </tr>
                            {% endset %}
                            {% macro row(count, i) %}
                                <tr>
                                    <td style="vertical-align: inherit; text-align: center">{{ count }}</td>
                                    <td style="vertical-align: inherit">{{ i.getName() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getType() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getTotalNumber() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getUnits() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getFactNumber() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getPutIntoOperation() }}</td>
                                    {% if i.getDeliveryDate() %}
                                        <td style="vertical-align: inherit; text-align: center">{{ i.getDeliveryDate().format('d.m.Y') }}</td>
                                    {% else %}
                                        <td style="vertical-align: inherit; text-align: center">Дата не указана</td>
                                    {% endif %}
                                    <td>{{ i.getOKPD2() }}</td>
                                    <td>{{ i.getKTRU() }}</td>
                                    <td>{{ i.getCountryOfOrigin() }}</td>
                                    <td style="vertical-align: inherit; text-align: center">{{ i.getComment() }}</td>
                                </tr>
                            {% endmacro %}
                            <div role="tabpanel" id="tab-2" class="tab-pane">
                                <div class="panel-body ">
                                    {% set infrastructure = zone.getZoneInfrastructureSheets() %}
                                    {% if infrastructure|length > 0 %}
                                        <div class="col-lg-12 col-md-12 col-sm-12 mb-3">
                                            <a href="{{ path('app_region_rm_infrastructure_sheet', {'id': zone.getId()}) }}">
                                                <button class="btn btn-outline-success col-lg-12">
                                                    <i class="fa fa-edit">
                                                        Внести изминения (Инфраструктурный лист)
                                                    </i>
                                                </button>
                                            </a>
                                        </div>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="12">
                                                        <h3>Общая зона</h3>
                                                    </td>
                                                </tr>
                                                {{ thead }}
                                            </thead>
                                            <tbody>
                                            {% set count = 1 %}
                                            {% for i in infrastructure %}
                                                {% set zoneTypeValue = i.getZoneType() %}
                                                {% if zoneTypeValue == 'Общая зона' %}
                                                    {{ _self.row(count, i) }}
                                                    {% set count = count + 1 %}
                                                {% endif %}
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="12">
                                                        <h3>Рабочее место учащегося</h3>
                                                    </td>
                                                </tr>
                                                {{ thead }}
                                            </thead>
                                            <tbody>
                                            {% set count = 1 %}
                                            {% for i in infrastructure %}
                                                {% set zoneTypeValue = i.getZoneType() %}
                                                {% if zoneTypeValue == 'Рабочее место учащегося' %}
                                                    {{ _self.row(count, i) }}
                                                    {% set count = count + 1 %}
                                                {% endif %}
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <td colspan="12">
                                                        <h3>Рабочее место преподавателя</h3>
                                                    </td>
                                                </tr>
                                                {{ thead }}
                                            </thead>
                                            <tbody>
                                            {% set count = 1 %}
                                            {% for i in infrastructure %}
                                                {% set zoneTypeValue = i.getZoneType() %}
                                                {% if zoneTypeValue == 'Рабочее место преподавателя' %}
                                                    {{ _self.row(count, i) }}
                                                    {% set count = count + 1 %}
                                                {% endif %}
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <div class="col-lg-6 offset-lg-3">
                                            <div class="panel panel-warning">
                                                <div class="panel-heading">
                                                    <i class="fa fa-warning"></i> Предупреждение
                                                </div>
                                                <div class="panel-body">
                                                    <p>
                                                        Инфраструктурный лист не предусмотрен или отсутствует
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="ibox-footer">

                </div>

            </div>
        </div>
    </div>


{% endblock %}

{% block scripts %}
    <script src="{{ asset('js/popper.min.js') }}"></script>
    <script src="{{ asset('js/inspinia.js') }}"></script>
    <script src="{{ asset('js/plugins/blueimp/jquery.blueimp-gallery.min.js') }}"></script>
{% endblock %}