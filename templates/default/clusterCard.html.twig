{% if i.getUserInfo().getRfSubject() is not null %}
    {% set isRegion = true %}
{% else %}
    {% set isRegion = false %}
{% endif %}
{% set isInspector = is_granted('ROLE_INSPECTOR') or is_granted('ROLE_SMALL_CURATOR') %}
<div class="col-lg-4 animated fadeIn cluster-card"
     data-year="{{ i.getUserInfo().getYear() }}"
     data-industry="{{ i.getUserInfo().getDeclaredIndustry() }}"
        {% if isRegion %}
            data-region="{{ i.getUserInfo().getRfSubject().getName() }}"
            data-district="{{ i.getUserInfo().getRfSubject().getDistrict() }}"
        {% endif %}

>
    <div class="contact-box">
        <div class="row">
            <div class="col-lg-12">
                {% if isInspector %}
                    <div class="row">
                        <div class="col-lg-12">
                            {% if i.getUserInfo().getContractCertifications()|length > 0 %}
                                {% set statusLib = {
                                    'Справка не прислана' : '-danger',
                                    'Файл на проверке' : '-warning',
                                    'Новый файл на проверке' : '-warning',
                                    'Отправлен на доработку' : '-danger',
                                    'Справка принята' : '-primary',

                                } %}
                                {% set status = i.getUserInfo().getContractCertifications().last().getStatus() %}
                                <a type="button" data-toggle="modal" data-target="#contractCertificateModal-{{ i.getUserIdentifier() }}">
                                    <span class="badge badge{{ statusLib[status] }} pull-right">
                                        {{ status }}
                                    </span>
                                </a>

                            {% endif %}
                            {% if  buttons is defined %}
                                {{ buttons }}
                            {% endif %}


                        </div>

                    </div>
                {% endif %}


                <h3>
                    <strong>
                        {{ i.getUserInfo().getEducationalOrganization() }}
                    </strong>

                </h3>


                {% if isRegion %}
                    <p><i class="fa fa-map-marker"></i> {{ i.getUserInfo().getRfSubject().getName() }}</p>
                {% else %}
                    <p class="red-bg"><i class="fa fa-map-marker"></i> Не указан регион!</p>
                {% endif %}
                <span class="badge badge-success">
                    {{ i.getUserInfo().getYear() }} год
                </span>
                <br>
                {% if "ROLE_SMALL_CLUSTERS" in  i.getRoles() %}
                    <span class="badge badge-success">
                        Малый кластер
                    </span>
                {% endif %}
                {% if "ROLE_REGION" in  i.getRoles() %}
                    <span class="badge badge-primary">
                        Производственный кластер
                    </span>
                {% endif %}
                <address>
                    <b>Кластер: </b>{{ i.getUserInfo().getCluster() }}<br>
                    <b>Отрасль: </b>{{ i.getUserInfo().getDeclaredIndustry() }} <br>
                    <b>Организация: </b>{{ i.getUserInfo().getOrganization() }}<br>
                    <b>Пользователь: </b>{{ i.getUuid() }} <br>

                    {#<abbr title="Phone">P:</abbr> (123) 456-7890#}
                </address>
                <div style="overflow: hidden">
                    <a href="{{ path('app_inspector_show_info_about_cluster', {'id': i.getId()}) }}">
                        <button class="btn btn-cyan col-lg-12 mb-2">
                            <div class="fa fa-archive"></div>
                            Подробная информация о кластере
                        </button>
                    </a>
                    {% if isInspector %}
                        {#<a href="{{ path('app_inspector_infrastructure_sheet_upload', {'id': i.getId()}) }}">#}
                        {#<button class="btn btn-primary col-lg-12 mb-2">#}
                        {#<div class="fa fa-upload"></div>#}
                        {#Загрузить ИЛ#}
                        {#</button>#}
                        {#</a>#}
                        {#<a href="{{ path('app_inspector_infrastructure_sheet_region_view', {'id': i.getId()}) }}">#}
                        {#<button class="btn btn-info col-lg-12 mb-2">#}
                        {#<div class="fa fa-search"></div>#}
                        {#Просмотр истории ИЛов#}
                        {#</button>#}
                        {#</a>#}
                        <a href="{{ path('app_inspector_show_purchases', {'id': i.getId()}) }}">
                            <button class="btn btn-info col-lg-12 mb-2">
                                <div class="fa fa-archive"></div>
                                Просмотр Закупок
                            </button>
                        </a>
                    {% endif %}

                    {% if isInspector %}
                        <a href="{{ path('app_weekly_budget_amount', {'id': i.getId()}) }}">
                            <button class="btn btn-success col-lg-12 mb-2">
                                <div class="fa fa-money"></div>
                                Недельная сумма по бюджету
                            </button>
                        </a>
                    {% endif %}

                    {% if isInspector %}
                        <a href="{{ path('app_inspector_readiness_map', {'id': i.getId()}) }}">
                            <button class="btn btn-primary col-lg-12 mb-2">
                                <div class="fa fa-check-circle"></div>
                                Карта готовности
                            </button>
                        </a>
                        <a href="{{ path('app_login', {'_switch_user': i.getUserIdentifier()}) }}">
                            <button class="btn btn-warning col-lg-12">
                                <div class="fa fa-leaf"></div>
                                Переключиться
                            </button>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="ibox-footer mt-3">
            {% for tag in i.getUserTags() %}
                <span class="badge">
                    {{ tag.getTag() }}
                </span>
            {% endfor %}
        </div>
        {% if isInspector and i.getUserInfo().getContractCertifications()|length > 0 %}
            <div class="modal fade" id="contractCertificateModal-{{ i.getUserIdentifier() }}" tabindex="-1"
                 role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"> {{ i.getUserInfo().getEducationalOrganization() }} </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <form action="{{ path('app_certificate_approve', {'id': i.getUserInfo().getContractCertifications().last().getId()}) }}" method="post">
                        <div class="modal-body">
                            {% set file = i.getUserInfo().getContractCertifications().last().getFile() %}
                            {% if file %}
                                <a href="{{ path('app_download_file_by_route', {'file': file, 'route': 'certificate_files_directory'}) }}">
                                    <i class="fa fa-download"></i> {{ file }}
                                </a>
                                <hr>


                                    <div class="col-sm-10">
                                        <div>
                                            <label>
                                                <input type="radio" checked="" value="Справка принята" id="optionsRadios1" name="optionsRadios">
                                                Принято
                                            </label>
                                        </div>
                                        <div>
                                            <label>
                                                <input type="radio" value="Отправлен на доработку" id="optionsRadios2" name="optionsRadios">
                                                На доработку
                                            </label>
                                        </div>
                                    </div>
                                    <input type="hidden" name="token" value="{{ csrf_token('approve-certification') }}"/>

                            {% else %}
                                <p>
                                    <span class="badge badge-danger">Справки нет</span>
                                </p>
                            {% endif %}
                        </div>
                        <div class="modal-footer">

                            {% if file %}
                                <button type="submit" class="btn btn-primary">Сохранить</button>
                            {% endif %}
                            <button type="button" class="btn" data-dismiss="modal">Закрыть</button>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>