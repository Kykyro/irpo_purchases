{{ include('default/header.html.twig') }}

{{ include('purchases_detail/templates/table_add.html.twig') }}

{{ include('default/footer.html.twig') }}


<script>
    // ToDo: провести рефакторинг!
    $(document).ready(function () {

        let initialSum = 0;
        let finSum = 0;
        let initialSumFull = false;
        let method = $('#form_MethodOfDetermining').find(":selected").text();
        if(method === 'Единственный поставщик')
        {
            $('#form_DateOfConclusion').prop('required',true);
            $('#form_publicationDate').prop('required',false);
        }
        else
        {
            $('#form_DateOfConclusion').prop('required',false);
            $('#form_publicationDate').prop('required',true);
        }


        $(".initial").each(function (i) {
            let value = $(this).val();
            initialSum += Number(value);
        }).promise().done(function () {
            if(initialSum > 0){
                $(".initial").prop('required',false);
            }
            else
            {
                $(".initial").prop('required',true);
            }
            let sum = initialSum.toString();
            sum = sum + "₽";
            $(".sum_initial").html(sum);
            initialSum = 0;
        });

        $(".initial").change(function() {
            $(".initial").each(function (i) {
                let value = $(this).val();
                if(value > 0){
                    initialSumFull = true;
                }
                initialSum += Number(value);
            }).promise().done(function () {
                if(initialSum > 0){
                    $(".initial").prop('required',false);
                }
                else
                {
                    $(".initial").prop('required',true);
                }
                let sum = initialSum.toString();
                sum = sum + "₽";
                $(".sum_initial").html(sum);
                initialSum = 0;
            });
        });
// финальная сумма
        $(".fin").each(function (i) {
            let value = $(this).val();
            finSum += Number(value);
        }).promise().done(function () {

            let sum = finSum.toString();
            sum = sum + "₽";
            $(".sum_fin").html(sum);
            finSum = 0;
        });

        $(".fin").change(function() {
            $(".fin").each(function (i) {
                let value = $(this).val();
                finSum += Number(value);
            }).promise().done(function () {

                let sum = finSum.toString();
                sum = sum + "₽";
                $(".sum_fin").html(sum);
                finSum = 0;
            });
        });


        $('#form_MethodOfDetermining').change(() => {
            let method = $(this).find(":selected").text();
            if(method === 'Единственный поставщик')
            {
                $('#form_DateOfConclusion').prop('required',true);
                $('#form_publicationDate').prop('required',false);
            }
            else
            {
                $('#form_DateOfConclusion').prop('required',false);
                $('#form_publicationDate').prop('required',true);
            }

        });

    });

</script>